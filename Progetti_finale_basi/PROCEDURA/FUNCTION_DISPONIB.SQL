-- FUNCTION CHE RESTITUISCE I PEZZI DISPONIBILI DI UN PRODOTTO
CREATE OR REPLACE FUNCTION DISPONIB(COD_BARRE0 VARCHAR,DATA_APP DATE) 
RETURN NUMBER IS 
PEZZI_DISP NUMBER;
SOMMA_TRASP NUMBER;
BEGIN

-- QUERY CHE DATO UN PRODOTTO QUALSIASI TROVA QUANTI PEZZI HO PORTATO NEI PUNTI VENDITA.
SELECT SUM(QUANTITA) INTO SOMMA_TRASP
FROM COSTITUITO_L
WHERE NUM_LOTTO=(SELECT NUM_LOTTO
				 FROM LOTTO
				 WHERE COD_BARRE=COD_BARRE0);
					
-- QUERY CHE DATO UN PRODOTTO QUALSIASI TROVA QUANTI PEZZI HO PORTATO IN MAGAZZINO PRIMA DELLA DATA DI UN PROSSIMO APPROVVIGIONAMENTO.
SELECT SUM(QUANTITA_LOTTO) INTO PEZZI_DISP
FROM LOTTO L JOIN FORNITURA F ON L.COD_FORNITURA=F.COD_FORNITURA
WHERE COD_BARRE = COD_BARRE0 AND DATA_FOR < DATA_APP;

					
PEZZI_DISP:= PEZZI_DISP-SOMMA_TRASP;
RETURN PEZZI_DISP;
END DISPONIB;
/
